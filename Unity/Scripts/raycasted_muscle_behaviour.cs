using System.Collections;
using System.Collections.Generic;
using System.Linq;
using UnityEngine;
using System.Runtime.InteropServices;



//Muscle highlighting behaviour script. Uses Physics.Raycast to determine what was clicked and highlights it.

public class raycasted_muscle_behaviour : MonoBehaviour {

    //DLLImport is used to call JS functions, which make up the application's connection with the page it is located in.
    [DllImport("__Internal")]
    private static extern void PrintArray(string str);


    public RaycastHit target;
    public Camera freelook;
    private Color standartGrey = new Color32(163, 163, 163, 255);
    private Color standartGreen = new Color32(0, 198, 0, 255);
    public GameObject fullbody;
    public List<int> sendData;
    private bool rising;
    public Color currentEmissionColor;
    

  
    void convertListToFloatArr()
    {
        PrintArray(string.Join(",", sendData.Select(x => x.ToString()).ToArray()));
    }
   
    void FixedUpdate()
    {
       
        Physics.Raycast(freelook.ScreenPointToRay(Input.mousePosition), out target);
        foreach (MeshRenderer b in fullbody.GetComponentsInChildren<MeshRenderer>())
        {
            if (b.material.color == standartGreen)
            {
                b.material.color = standartGrey;
            }
        }
        if (target.collider.gameObject.tag == "Targetable")
        {
            foreach (MeshRenderer a in target.collider.gameObject.GetComponentsInChildren<MeshRenderer>())
            {
                if (a.material.color != Color.yellow)
                {
                    a.material.color = standartGreen;
                }
            }
           
        }
    }
	void Update () {
        

		if (Input.GetMouseButtonDown(0))
        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
            Physics.Raycast(freelook.ScreenPointToRay(Input.mousePosition), out target);
            Debug.Log(target.collider.gameObject.tag);
            if (target.collider.gameObject.tag == "Targetable")//just a check not to highlight unnesessary objects
            {
                foreach (MeshRenderer partialMesh in target.collider.gameObject.GetComponentsInChildren<MeshRenderer>())
                {
                    if (partialMesh.material.color != Color.yellow)
                    {//highlight!
                        partialMesh.material.color = Color.yellow;
                        partialMesh.GetComponentInParent<targetable_muscle_properties>().targeted = true;
                        //collection addition
                        int multipleChecks = 1;
                        multipleChecks = sendData.Find(item => item == partialMesh.GetComponentInParent<targetable_muscle_properties>().musculeIndex) == partialMesh.GetComponentInParent<targetable_muscle_properties>().musculeIndex ? -1 : 1;
                        if (multipleChecks == 1)
                        {
                            sendData.Add(partialMesh.GetComponentInParent<targetable_muscle_properties>().musculeIndex);
                        }
                       
                    }
                    else//unhighlight!
                    {
                        partialMesh.material.color = new Color32(163, 163, 163, 1); ;//standart material "Grey": Homecoming.
                        partialMesh.GetComponentInParent<targetable_muscle_properties>().targeted = false;
                        //collection withdrawal
                        sendData.Remove(partialMesh.GetComponentInParent<targetable_muscle_properties>().musculeIndex);
                    }
                }
            }
            else
            {//if (target.collider.gameObject.tag == "Untargetable")

                Debug.Log("Blank space clicked - returning everything back to standart");
                foreach (MeshRenderer partMesh in fullbody.GetComponentsInChildren<MeshRenderer>())
                {
                    Debug.Log(partMesh.gameObject.name);
                    partMesh.material.color = new Color32(163, 163, 163, 1);//back in ... GREY?
                    if (partMesh.gameObject.GetComponentInParent<targetable_muscle_properties>() != null)
                    {
                        partMesh.gameObject.GetComponentInParent<targetable_muscle_properties>().targeted = false;
                    }

                }
                //collection cleaning
                sendData.Clear();
            }


            convertListToFloatArr();
        }

	}
}
